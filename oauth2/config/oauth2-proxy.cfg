# Basic Auth Configuration
http_address = "0.0.0.0:4180"
cookie_secret = "${OAUTH2_PROXY_SECRET}"
# Allow all email domain for accounts
email_domains = ["*"]

# Cookie Settings
cookie_secure = true
cookie_samesite = "lax"
cookie_domains = ["${HOST_DOMAIN}"]
cookie_expire = "4h"
cookie_refresh = "1h"
cookie_name = "_oauth2_proxy"
cookie_csrf_per_request = true
cookie_csrf_expire = "5m"

# Upstream Configuration
upstreams = ["https://${HOST_DOMAIN}/"]
whitelist_domains = ["${HOST_DOMAIN}"]

# Keycloak Provider Configuration
provider = "keycloak-oidc"
client_id = "idapt-oauth2-proxy"
client_secret_file = "/keycloak_oauth2_client_secret/OAUTH2_PROXY_CLIENT_SECRET"
redirect_url = "https://${HOST_DOMAIN}/oauth2/callback"
oidc_issuer_url = "https://${HOST_DOMAIN}/auth/realms/master"

# PKCE Support
code_challenge_method = "S256"

# Skip SSL verification for internal communication
ssl_insecure_skip_verify = true

# Token and Claims Configuration
pass_access_token = true
pass_authorization_header = true
pass_user_headers = true
set_authorization_header = true
set_xauthrequest = true
user_id_claim = "sub"
#email = "email"
scope = "openid email profile roles"

# Session and Authentication Settings
session_store_type = "cookie"
standard_logging = true
auth_logging = true
request_logging = true

# Skip provider selection since we only use Keycloak
skip_provider_button = true
provider_display_name = "Keycloak"

# Role-based Access Control
# Uncomment and adjust these as needed for your application
#allowed_role = "admin"
#allowed_role = "idapt-oauth2-proxy:user"

# Customize sign-in page
custom_sign_in_logo = ""
banner = "Secure Access Required"