(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[365],{8100:(e,t,s)=>{Promise.resolve().then(s.bind(s,7690))},7690:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ee});var a=s(5155),i=s(5434),n=s(2115),l=s(9393),r=s(1681),o=s(2354),d=s(9508);let c=(0,n.memo)(function(e){let{}=e,{tryToSetCurrentChat:t}=(0,d.x)();return(0,a.jsx)("header",{className:"flex sticky top-0 bg-background py-1.5 items-center px-2 md:px-2 gap-2",children:(0,a.jsxs)(o.m_,{children:[(0,a.jsx)(o.k$,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",className:"order-2 md:order-1 md:px-2 px-2 md:h-fit ml-auto md:ml-0",onClick:()=>{t(void 0)},children:[(0,a.jsx)(r.c1,{}),(0,a.jsx)("span",{className:"md:sr-only",children:"New Chat"})]})}),(0,a.jsx)(o.ZI,{children:"New Chat"})]})})});var u=s(4617),m=s.n(u),x=s(814),h=s(6390),g=s(2558),f=s(6631),p=s(9124);let b=(0,n.memo)(function(e){let{chatId:t,append:s}=e;return(0,a.jsx)("div",{className:"grid sm:grid-cols-2 gap-2 w-full",children:[{title:"Where to go eat tonight?",label:"based on my personal preferences",action:"Where to go eat tonight?"},{title:"How to make progress on my current project?",label:"using the connected datasources",action:"How to make progress on my current project?"},{title:"Ideas of activities to do with my mom",label:"based on our preferences",action:"Give me ideas of activities to do with my mom based on our preferences"},{title:"Last thing i talked about with my best friend?",label:"using our message history",action:"What is the last thing i talked about with my best friend?"}].map((e,t)=>(0,a.jsx)(p.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{delay:.05*t},className:t>1?"hidden sm:block":"block",children:(0,a.jsxs)(l.$,{variant:"ghost",onClick:()=>{s({role:"user",content:e.action})},className:"text-left border rounded-xl px-4 py-3.5 text-sm flex-1 gap-1 sm:flex-col w-full h-auto justify-start items-start",children:[(0,a.jsx)("span",{className:"font-medium",children:e.title}),(0,a.jsx)("span",{className:"text-muted-foreground",children:e.label})]})},"suggested-action-".concat(e.title,"-").concat(t)))})},()=>!0);var j=s(5979),v=s.n(j);let y=(0,n.memo)(function(e){let{chatId:t,input:s,setInput:i,isLoading:l,stop:r,attachments:o,setAttachments:d,messages:c,setMessages:u,append:g,handleSubmit:p,className:j}=e,v=(0,n.useRef)(null),{width:y}=(0,h.lW)();(0,n.useEffect)(()=>{v.current&&N()},[]);let N=()=>{v.current&&(v.current.style.height="auto",v.current.style.height="".concat(v.current.scrollHeight+2,"px"))},z=()=>{v.current&&(v.current.style.height="auto",v.current.style.height="98px")},[I,L]=(0,h.Mj)("input","");(0,n.useEffect)(()=>{v.current&&(i(v.current.value||I||""),N())},[]),(0,n.useEffect)(()=>{L(s)},[s,L]);let C=(0,n.useRef)(null),[S,R]=(0,n.useState)([]),P=(0,n.useCallback)(()=>{if(p(void 0,{experimental_attachments:o}),d([]),L(""),z(),y&&y>768){var e;null===(e=v.current)||void 0===e||e.focus()}},[o,p,d,L,y]),M=async e=>{let t=new FormData;t.append("file",e);try{let e=await fetch("/api/files/upload",{method:"POST",body:t});if(e.ok){let{url:t,pathname:s,contentType:a}=await e.json();return{url:t,name:s,contentType:a}}let{error:s}=await e.json();x.oR.error(s)}catch(e){x.oR.error("Failed to upload file, please try again!")}},E=(0,n.useCallback)(async e=>{let t=Array.from(e.target.files||[]);R(t.map(e=>e.name));try{let e=t.map(e=>M(e)),s=(await Promise.all(e)).filter(e=>void 0!==e);d(e=>[...e,...s])}catch(e){console.error("Error uploading files!",e)}finally{R([])}},[d]);return(0,a.jsxs)("div",{className:"relative w-full flex flex-col gap-4",children:[0===c.length&&0===o.length&&0===S.length&&(0,a.jsx)(b,{append:g,chatId:t}),(0,a.jsx)("input",{type:"file",className:"fixed -top-4 -left-4 size-0.5 opacity-0 pointer-events-none",ref:C,multiple:!0,onChange:E,tabIndex:-1}),(0,a.jsx)(f.T,{ref:v,placeholder:"Send a message...",value:s,onChange:e=>{i(e.target.value),N()},className:m()("min-h-[24px] max-h-[calc(75dvh)] overflow-hidden resize-none rounded-2xl !text-base bg-muted pb-10 dark:border-zinc-700",j),rows:2,autoFocus:!0,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),l?x.oR.error("Please wait for the model to finish its response!"):P())}}),(0,a.jsx)("div",{className:"absolute bottom-0 right-0 p-2 w-fit flex flex-row justify-end",children:l?(0,a.jsx)(w,{stop:r,setMessages:u}):(0,a.jsx)(k,{input:s,submitForm:P,uploadQueue:S})})]})},(e,t)=>!!(e.input===t.input&&e.isLoading===t.isLoading&&v()(e.attachments,t.attachments))),w=(0,n.memo)(function(e){let{stop:t,setMessages:s}=e;return(0,a.jsx)(l.$,{className:"rounded-full p-1.5 h-fit border dark:border-zinc-600",onClick:e=>{e.preventDefault(),t(),s(e=>(0,g.y8)(e))},children:(0,a.jsx)(r.wF,{size:14})})}),k=(0,n.memo)(function(e){let{submitForm:t,input:s,uploadQueue:i}=e;return(0,a.jsx)(l.$,{className:"rounded-full p-1.5 h-fit border dark:border-zinc-600",onClick:e=>{e.preventDefault(),t()},disabled:0===s.length||i.length>0,children:(0,a.jsx)(r.Kp,{size:14})})},(e,t)=>e.uploadQueue.length===t.uploadQueue.length&&e.input===t.input);var N=s(5683),z=s(8173),I=s.n(z),L=s(3550),C=s(6246);let S={code:function(e){let{node:t,inline:s,className:i,children:l,...r}=e,[o,d]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),m=/language-(\w+)/.exec(i||"");m&&m[1],String(l).replace(/\n$/,"");let[x,h]=(0,n.useState)("code");return s?(0,a.jsx)("code",{className:"".concat(i," text-sm bg-zinc-100 dark:bg-zinc-800 py-0.5 px-1 rounded-md"),...r,children:l}):(0,a.jsxs)("div",{className:"not-prose flex flex-col",children:["code"===x&&(0,a.jsx)("pre",{...r,className:"text-sm w-full overflow-x-auto dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 rounded-xl dark:text-zinc-50 text-zinc-900",children:(0,a.jsx)("code",{className:"whitespace-pre-wrap break-words",children:l})}),"run"===x&&o&&(0,a.jsx)("div",{className:"text-sm w-full overflow-x-auto bg-zinc-800 dark:bg-zinc-900 p-4 border border-zinc-200 dark:border-zinc-700 border-t-0 rounded-b-xl text-zinc-50",children:(0,a.jsx)("code",{children:o})})]})},p:e=>{let{node:t,children:s,...i}=e;return(null==t?void 0:t.children.length)===1&&(null==t?void 0:t.children[0].type)==="element"&&(null==t?void 0:t.children[0].tagName)==="code"?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)("p",{...i,children:s})},pre:e=>{let{children:t}=e;return(0,a.jsx)(a.Fragment,{children:t})},ol:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("ol",{className:"list-decimal list-outside ml-4",...i,children:s})},li:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("li",{className:"py-1",...i,children:s})},ul:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("ul",{className:"list-decimal list-outside ml-4",...i,children:s})},strong:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("span",{className:"font-semibold",...i,children:s})},a:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)(I(),{className:"text-blue-500 hover:underline",target:"_blank",rel:"noreferrer",...i,children:s})},h1:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h1",{className:"text-3xl font-semibold mt-6 mb-2",...i,children:s})},h2:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h2",{className:"text-2xl font-semibold mt-6 mb-2",...i,children:s})},h3:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h3",{className:"text-xl font-semibold mt-6 mb-2",...i,children:s})},h4:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h4",{className:"text-lg font-semibold mt-6 mb-2",...i,children:s})},h5:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h5",{className:"text-base font-semibold mt-6 mb-2",...i,children:s})},h6:e=>{let{node:t,children:s,...i}=e;return(0,a.jsx)("h6",{className:"text-sm font-semibold mt-6 mb-2",...i,children:s})}},R=[C.A],P=(0,n.memo)(e=>{let{children:t}=e;return(0,a.jsx)(L.o,{remarkPlugins:R,components:S,children:t})},(e,t)=>e.children===t.children);var M=s(1862);let E=(0,n.memo)(function(e){let{chatId:t,message:s,isLoading:i}=e,{mutate:n}=(0,M.iX)(),[d,c]=(0,h.Cj)();return i||"user"===s.role||s.toolInvocations&&s.toolInvocations.length>0?null:(0,a.jsx)(o.Bc,{delayDuration:0,children:(0,a.jsx)("div",{className:"flex flex-row gap-2",children:(0,a.jsxs)(o.m_,{children:[(0,a.jsx)(o.k$,{asChild:!0,children:(0,a.jsx)(l.$,{className:"py-1 px-2 h-fit text-muted-foreground",variant:"outline",onClick:async()=>{await c(s.content),x.oR.success("Copied to clipboard!")},children:(0,a.jsx)(r.Td,{})})}),(0,a.jsx)(o.ZI,{children:"Copy"})]})})})},(e,t)=>e.isLoading===t.isLoading);var _=s(1235);let B=(0,n.memo)(e=>{let{chatId:t,message:s,isLoading:i,setMessages:l,reload:o,isReadonly:d}=e,[c,u]=(0,n.useState)("view");return(0,a.jsx)(N.N,{children:(0,a.jsx)(p.P.div,{className:"w-full mx-auto max-w-3xl px-4 group/message",initial:{y:5,opacity:0},animate:{y:0,opacity:1},"data-role":s.role,children:(0,a.jsxs)("div",{className:(0,_.cn)("flex gap-4 w-full group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl",{"w-full":"edit"===c,"group-data-[role=user]/message:w-fit":"edit"!==c}),children:["assistant"===s.role&&(0,a.jsx)("div",{className:"size-8 flex items-center rounded-full justify-center ring-1 shrink-0 ring-border bg-background",children:(0,a.jsx)("div",{className:"translate-y-px",children:(0,a.jsx)(r.BZ,{size:14})})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[s.content&&"view"===c&&(0,a.jsx)("div",{className:"flex flex-row gap-2 items-start",children:(0,a.jsx)("div",{className:(0,_.cn)("flex flex-col gap-4",{"bg-[#3a81ff] text-white px-3 py-2 rounded-xl":"user"===s.role}),children:(0,a.jsx)(P,{children:s.content})})}),s.toolInvocations&&s.toolInvocations.length>0&&(0,a.jsx)("div",{className:"flex flex-col gap-4",children:s.toolInvocations.map(e=>{let{toolName:t,toolCallId:s,state:i,args:n}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("pre",{children:JSON.stringify(e,null,2)})},s)})}),!d&&(0,a.jsx)(E,{chatId:t,message:s,isLoading:i},"action-".concat(s.id))]})]})})})},(e,t)=>!!(e.isLoading===t.isLoading&&e.message.content===t.message.content&&v()(e.message.toolInvocations,t.message.toolInvocations))),D=()=>(0,a.jsx)(p.P.div,{className:"w-full mx-auto max-w-3xl px-4 group/message ",initial:{y:5,opacity:0},animate:{y:0,opacity:1,transition:{delay:1}},"data-role":"assistant",children:(0,a.jsxs)("div",{className:m()("flex gap-4 group-data-[role=user]/message:px-3 w-full group-data-[role=user]/message:w-fit group-data-[role=user]/message:ml-auto group-data-[role=user]/message:max-w-2xl group-data-[role=user]/message:py-2 rounded-xl",{"group-data-[role=user]/message:bg-muted":!0}),children:[(0,a.jsx)("div",{className:"size-8 flex items-center rounded-full justify-center ring-1 shrink-0 ring-border",children:(0,a.jsx)(r.BZ,{size:14})}),(0,a.jsx)("div",{className:"flex flex-col gap-2 w-full",children:(0,a.jsx)("div",{className:"flex flex-col gap-4 text-muted-foreground",children:"Thinking..."})})]})});function F(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let s=e.current,a=t.current;if(s&&a){let e=new MutationObserver(()=>{a.scrollIntoView({behavior:"instant",block:"end"})});return e.observe(s,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>e.disconnect()}},[]),[e,t]}let $=(0,n.memo)(function(e){let{chatId:t,isLoading:s,messages:i,setMessages:n,reload:l,isReadonly:r}=e,[o,d]=F();return(0,a.jsxs)("div",{ref:o,className:"flex flex-col min-w-0 gap-6 flex-1 overflow-y-scroll pt-4",children:[i.map((e,o)=>(0,a.jsx)(B,{chatId:t,message:e,isLoading:s&&i.length-1===o,setMessages:n,reload:l,isReadonly:r},e.id)),s&&i.length>0&&"user"===i[i.length-1].role&&(0,a.jsx)(D,{}),(0,a.jsx)("div",{ref:d,className:"shrink-0 min-w-[24px] min-h-[24px]"})]})},(e,t)=>!!e.isBlockVisible&&!!t.isBlockVisible||e.isLoading===t.isLoading&&(!e.isLoading||!t.isLoading)&&e.messages.length===t.messages.length&&!!v()(e.messages,t.messages));var V=s(7021);let A={documentId:"init",content:"",kind:"text",title:"",status:"idle",isVisible:!1,boundingBox:{top:0,left:0,width:0,height:0}};function T(){let{data:e,mutate:t}=(0,V.Ay)("block",null,{fallbackData:A}),s=(0,n.useMemo)(()=>e||A,[e]),a=(0,n.useCallback)(e=>{t(t=>{let s=t||A;return"function"==typeof e?e(s):e})},[t]),{data:i,mutate:l}=(0,V.Ay)(()=>s.documentId?"block-metadata-".concat(s.documentId):null,null,{fallbackData:null});return(0,n.useMemo)(()=>({block:s,setBlock:a,metadata:i,setMetadata:l}),[s,a,i,l])}var O=s(3244);let W=(0,n.memo)(function(e){let{block:t,metadata:s,setMetadata:i}=e,[r,d]=(0,n.useState)(!1),c=G.find(e=>e.kind===t.kind);if(!c)throw Error("Block definition not found!");let u={content:t.content,metadata:s,setMetadata:i};return(0,a.jsx)("div",{className:"flex flex-row gap-1",children:c.actions.map(e=>(0,a.jsxs)(o.m_,{children:[(0,a.jsx)(o.k$,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",className:(0,_.cn)("h-fit dark:hover:bg-zinc-700",{"p-2":!e.label,"py-1.5 px-2":e.label}),onClick:async()=>{d(!0);try{await Promise.resolve(e.onClick(u))}catch(e){x.oR.error("Failed to execute action")}finally{d(!1)}},disabled:!!r||"streaming"===t.status||!!e.isDisabled&&e.isDisabled(u),children:[e.icon,e.label]})}),(0,a.jsx)(o.ZI,{children:e.description})]},e.description))})},(e,t)=>e.block.status===t.block.status),Z=(0,n.memo)(function(){let{setBlock:e}=T();return(0,a.jsx)(l.$,{variant:"outline",className:"h-fit p-2 dark:hover:bg-zinc-700",onClick:()=>{e(e=>"streaming"===e.status?{...e,isVisible:!1}:{...A,status:"idle"})},children:(0,a.jsx)(r.w0,{size:18})})},()=>!0),K=(0,n.memo)(function(e){let{chatId:t,isLoading:s,messages:i,setMessages:n,reload:l,isReadonly:r}=e,[o,d]=F();return(0,a.jsxs)("div",{ref:o,className:"flex flex-col gap-4 h-full items-center overflow-y-scroll px-4 pt-20",children:[i.map((e,o)=>(0,a.jsx)(B,{chatId:t,message:e,isLoading:s&&o===i.length-1,setMessages:n,reload:l,isReadonly:r},e.id)),(0,a.jsx)("div",{ref:d,className:"shrink-0 min-w-[24px] min-h-[24px]"})]})},function(e,t){return"streaming"===e.blockStatus&&"streaming"===t.blockStatus||e.isLoading===t.isLoading&&(!e.isLoading||!t.isLoading)&&e.messages.length===t.messages.length});var H=s(8963);class Q{constructor(e){this.kind=e.kind,this.description=e.description,this.content=e.content,this.actions=e.actions||[],this.toolbar=e.toolbar||[],this.initialize=e.initialize||(async()=>({})),this.onStreamPart=e.onStreamPart}}let Y=e=>{let{blockKind:t}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-12 bg-muted-foreground/20 w-1/2"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-full"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-full"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-1/3"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-5 bg-transparent w-52"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-8 bg-muted-foreground/20 w-52"}),(0,a.jsx)("div",{className:"animate-pulse rounded-lg h-5 bg-muted-foreground/20 w-2/3"})]})},G=[new Q({kind:"text",description:"Useful for text content, like drafting essays and emails.",onStreamPart:e=>{let{streamPart:t,setMetadata:s,setBlock:a}=e;"text-delta"===t.type&&a(e=>({...e,content:e.content+t.content,isVisible:"streaming"===e.status&&e.content.length>400&&e.content.length<450||e.isVisible,status:"streaming"}))},content:e=>{let{status:t,content:s,isLoading:i,metadata:n}=e;return i?(0,a.jsx)(Y,{blockKind:"text"}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"flex flex-row py-8 md:p-20 px-4",children:(0,a.jsx)("div",{className:"md:hidden h-dvh w-12 shrink-0"})})})},actions:[],toolbar:[]})],J=(0,n.memo)(function(e){let{chatId:t,input:s,setInput:i,handleSubmit:l,isLoading:r,stop:o,attachments:d,setAttachments:c,append:u,messages:m,setMessages:x,reload:g,isReadonly:f}=e,{block:b,setBlock:j,metadata:v,setMetadata:y}=T(),{open:w}=(0,H.cL)(),{width:k,height:z}=(0,h.lW)(),I=!!k&&k<768,L=G.find(e=>e.kind===b.kind);if(!L)throw Error("Block definition not found!");return(0,n.useEffect)(()=>{b&&"init"!==b.documentId&&L.initialize&&L.initialize({documentId:b.documentId,setMetadata:y})},[b,L,y]),(0,a.jsx)(N.N,{children:b.isVisible&&(0,a.jsxs)(p.P.div,{className:"flex flex-row h-dvh w-dvw fixed top-0 left-0 z-50 bg-transparent",initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{delay:.4}},children:[!I&&(0,a.jsx)(p.P.div,{className:"fixed bg-background h-dvh",initial:{width:w?k-256:k,right:0},animate:{width:k,right:0},exit:{width:w?k-256:k,right:0}}),!I&&(0,a.jsx)(p.P.div,{className:"relative w-[400px] bg-muted dark:bg-background h-dvh shrink-0",initial:{opacity:0,x:10,scale:1},animate:{opacity:1,x:0,scale:1,transition:{delay:.2,type:"spring",stiffness:200,damping:30}},exit:{opacity:0,x:0,scale:1,transition:{duration:0}},children:(0,a.jsx)("div",{className:"flex flex-col h-full justify-between items-center gap-4",children:(0,a.jsx)(K,{chatId:t,isLoading:r,messages:m,setMessages:x,reload:g,isReadonly:f,blockStatus:b.status})})}),(0,a.jsxs)(p.P.div,{className:"fixed dark:bg-muted bg-background h-dvh flex flex-col overflow-y-scroll md:border-l dark:border-zinc-700 border-zinc-200",initial:{opacity:1,x:b.boundingBox.left,y:b.boundingBox.top,height:b.boundingBox.height,width:b.boundingBox.width,borderRadius:50},animate:I?{opacity:1,x:0,y:0,height:z,width:k||"calc(100dvw)",borderRadius:0,transition:{delay:0,type:"spring",stiffness:200,damping:30,duration:5e3}}:{opacity:1,x:400,y:0,height:z,width:k?k-400:"calc(100dvw-400px)",borderRadius:0,transition:{delay:0,type:"spring",stiffness:200,damping:30,duration:5e3}},exit:{opacity:0,scale:.5,transition:{delay:.1,type:"spring",stiffness:600,damping:30}},children:[(0,a.jsxs)("div",{className:"p-2 flex flex-row justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-start",children:[(0,a.jsx)(Z,{}),(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)("div",{className:"font-medium",children:b.title})})]}),(0,a.jsx)(W,{block:b,metadata:v,setMetadata:y})]}),(0,a.jsx)("div",{className:"dark:bg-muted bg-background h-full overflow-y-scroll !max-w-full items-center",children:(0,a.jsx)(L.content,{title:b.title,content:b.content,status:b.status,isInline:!1,isLoading:!b.content,metadata:v,setMetadata:y})})]})]})})},(e,t)=>!!(e.isLoading===t.isLoading&&e.input===t.input&&v()(e.messages,t.messages.length)));var U=s(7908);function X(e){let{isReadonly:t}=e,{backend:s}=(0,O.T)(),{token:l}=(0,U.A)(),{currentChatId:r,currentChat:o,refreshChats:u,tryToSetCurrentChat:m}=(0,d.x)(),{messages:x,setMessages:h,handleSubmit:f,input:p,setInput:b,append:j,isLoading:v,stop:w,reload:k}=(0,i.Y_)({api:"".concat(s,"/api/chat?datasource_name=Chats"),headers:{Authorization:"Bearer ".concat(l)},id:r,body:{id:r},initialMessages:(0,g.b2)((null==o?void 0:o.messages)||[]),experimental_throttle:100,sendExtraMessageFields:!0,onFinish:e=>{u()}}),N=async()=>(void 0==o&&await m(r),await f({preventDefault:()=>{}})),z=async e=>{void 0==o&&await m(r);let t=await j(e);return u(),t};(0,n.useEffect)(()=>{(null==o?void 0:o.messages)&&h((0,g.b2)(o.messages)),r&&""!==r||(h([]),b(""))},[o,h,b,r]);let[I,L]=(0,n.useState)([]),C=function(e){let{data:t}=(0,V.Ay)("block",null,{fallbackData:A});return(0,n.useMemo)(()=>t?e(t):e(A),[t,e])}(e=>e.isVisible);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col min-w-0 h-dvh bg-background",children:[(0,a.jsx)(c,{}),(0,a.jsx)($,{chatId:r,isLoading:v,messages:x,setMessages:h,reload:k,isReadonly:t,isBlockVisible:C}),(0,a.jsx)("form",{className:"flex mx-auto px-4 bg-background pb-4 md:pb-6 gap-2 w-full md:max-w-3xl",children:!t&&(0,a.jsx)(y,{chatId:r,input:p,setInput:b,handleSubmit:N,isLoading:v,stop:w,attachments:I,setAttachments:L,messages:x,setMessages:h,append:z})})]}),(0,a.jsx)(J,{chatId:r,input:p,setInput:b,handleSubmit:f,isLoading:v,stop:w,attachments:I,setAttachments:L,append:z,messages:x,setMessages:h,reload:k,isReadonly:t})]})}function q(){let{currentChatId:e}=(0,d.x)(),{data:t}=(0,i.Y_)({id:e}),{block:s,setBlock:a,setMetadata:l}=T(),r=(0,n.useRef)(-1);return(0,n.useEffect)(()=>{if(!(null==t?void 0:t.length))return;let e=t.slice(r.current+1);r.current=t.length-1,e.forEach(e=>{let t=G.find(e=>e.kind===s.kind);(null==t?void 0:t.onStreamPart)&&t.onStreamPart({streamPart:e,setBlock:a,setMetadata:l}),a(t=>{if(!t)return{...A,status:"streaming"};switch(e.type){case"id":return{...t,documentId:e.content,status:"streaming"};case"title":return{...t,title:e.content,status:"streaming"};case"kind":return{...t,kind:e.content,status:"streaming"};case"clear":return{...t,content:"",status:"streaming"};case"finish":return{...t,status:"idle"};default:return t}})})},[t,a,l,s]),null}function ee(){return(0,a.jsxs)("div",{className:"flex-1 h-full w-full",children:[(0,a.jsx)(X,{isReadonly:!1}),(0,a.jsx)(q,{})]})}},6631:(e,t,s)=>{"use strict";s.d(t,{T:()=>l});var a=s(5155),i=s(2115),n=s(1235);let l=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});l.displayName="Textarea"}},e=>{var t=t=>e(e.s=t);e.O(0,[738,906,119,895,641,814,173,355,491,908,886,441,517,358],()=>t(8100)),_N_E=e.O()}]);